From 4a834b950488f7b6628da6c62d7461abc3efbefd Mon Sep 17 00:00:00 2001
From: Victor Herrero Otal <victor.herrero.otal@sap.com>
Date: Wed, 5 Jun 2024 15:23:40 +0200
Subject: [PATCH 06/11] Downgrade k8s.io/kube-state-metrics/v2 to v2.11.0

This commit downgrades k8s.io/kube-state-metrics/v2 from v2.12.0 to
v2.11.0 to avoid a version conflict with k8s.io/component-base v0.29.5.

The newer version of k8s.io/kube-state-metrics/v2 (v2.12.0) requires a
version of github.com/prometheus/common (v0.51.1) that contains a
breaking change. This breaking change is incompatible with the version of
k8s.io/component-base (v0.29.5) that we're using.

By downgrading k8s.io/kube-state-metrics/v2 to v2.11.0, we can avoid this
issue, as this version does not require the breaking change in
github.com/prometheus/common.

This change should not affect the runtime behavior, as the changes between
k8s.io/kube-state-metrics/v2 v2.11.0 and v2.12.0 do not affect the YAML
serialization of the custom resource state data structures.

Once a new version of kubernetes/component-base is released containing
the fix
https://github.com/kubernetes/component-base/commit/62c04b35eff68f7d4087f94b7b1228facb375141
for the breaking change
https://github.com/prometheus/common/commit/bd41eb6b9dee4fa983f31ae8756700efde1f3ea2
that was introduced in v0.48.0 of prometheus/common, we can upgrade the
kube-state-metrics/v2 to v2.12.0.

Otherwise when using kube-state-metrics/v2 in version v2.12.0 the build
fails with a compilation error.

```
go get k8s.io/kube-state-metrics/v2@v2.11.0
go mod tidy
```

Co-authored-by: Istvan Zoltan Ballok <istvan.zoltan.ballok@sap.com>
---
 go.mod |  8 ++++----
 go.sum | 16 ++++++++--------
 2 files changed, 12 insertions(+), 12 deletions(-)

diff --git a/go.mod b/go.mod
index 7d4856da2..a1f4922c0 100644
--- a/go.mod
+++ b/go.mod
@@ -32,8 +32,8 @@ require (
 	github.com/opencontainers/image-spec v1.1.0
 	github.com/prometheus-operator/prometheus-operator/pkg/apis/monitoring v0.74.0
 	github.com/prometheus/blackbox_exporter v0.24.0
-	github.com/prometheus/client_golang v1.19.0
-	github.com/prometheus/common v0.51.1
+	github.com/prometheus/client_golang v1.18.0
+	github.com/prometheus/common v0.47.0
 	github.com/robfig/cron v1.2.0
 	github.com/spf13/afero v1.11.0
 	github.com/spf13/cobra v1.8.1
@@ -70,7 +70,7 @@ require (
 	k8s.io/kube-aggregator v0.29.6
 	k8s.io/kube-openapi v0.0.0-20231010175941-2dd684a91f00
 	k8s.io/kube-proxy v0.29.6
-	k8s.io/kube-state-metrics/v2 v2.12.0
+	k8s.io/kube-state-metrics/v2 v2.11.0
 	k8s.io/kubelet v0.29.6
 	k8s.io/metrics v0.29.6
 	k8s.io/pod-security-admission v0.29.6
@@ -251,7 +251,7 @@ require (
 	k8s.io/gengo v0.0.0-20230829151522-9cce18d56c01 // indirect
 	k8s.io/klog v1.0.0 // indirect
 	k8s.io/kms v0.29.6 // indirect
-	k8s.io/sample-controller v0.29.3 // indirect
+	k8s.io/sample-controller v0.28.4 // indirect
 	oras.land/oras-go v1.2.4 // indirect
 	sigs.k8s.io/apiserver-network-proxy/konnectivity-client v0.28.0 // indirect
 	sigs.k8s.io/json v0.0.0-20221116044647-bc3834ca7abd // indirect
diff --git a/go.sum b/go.sum
index b22cb3373..51d78016e 100644
--- a/go.sum
+++ b/go.sum
@@ -499,8 +499,8 @@ github.com/prometheus/blackbox_exporter v0.24.0/go.mod h1:SfZtJPNWmR8SskeJMmggTp
 github.com/prometheus/client_golang v0.9.1/go.mod h1:7SWBe2y4D6OKWSNQJUaRYU/AaXPKyh/dDVn+NZz0KFw=
 github.com/prometheus/client_golang v1.0.0/go.mod h1:db9x61etRT2tGnBNRi70OPL5FsnadC4Ky3P0J6CfImo=
 github.com/prometheus/client_golang v1.1.0/go.mod h1:I1FGZT9+L76gKKOs5djB6ezCbFQP1xR9D75/vuwEF3g=
-github.com/prometheus/client_golang v1.19.0 h1:ygXvpU1AoN1MhdzckN+PyD9QJOSD4x7kmXYlnfbA6JU=
-github.com/prometheus/client_golang v1.19.0/go.mod h1:ZRM9uEAypZakd+q/x7+gmsvXdURP+DABIEIjnmDdp+k=
+github.com/prometheus/client_golang v1.18.0 h1:HzFfmkOzH5Q8L8G+kSJKUx5dtG87sewO+FoDDqP5Tbk=
+github.com/prometheus/client_golang v1.18.0/go.mod h1:T+GXkCk5wSJyOqMIzVgvvjFDlkOQntgjkJWKrN5txjA=
 github.com/prometheus/client_model v0.0.0-20180712105110-5c3871d89910/go.mod h1:MbSGuTsp3dbXC40dX6PRTWyKYBIrTGTE9sqQNg2J8bo=
 github.com/prometheus/client_model v0.0.0-20190129233127-fd36f4220a90/go.mod h1:xMI15A0UPsDsEKsMN9yxemIoYk6Tm2C1GtYGdfGttqA=
 github.com/prometheus/client_model v0.0.0-20190812154241-14fe0d1b01d4/go.mod h1:xMI15A0UPsDsEKsMN9yxemIoYk6Tm2C1GtYGdfGttqA=
@@ -508,8 +508,8 @@ github.com/prometheus/client_model v0.6.0 h1:k1v3CzpSRUTrKMppY35TLwPvxHqBu0bYgxZ
 github.com/prometheus/client_model v0.6.0/go.mod h1:NTQHnmxFpouOD0DpvP4XujX3CdOAGQPoaGhyTchlyt8=
 github.com/prometheus/common v0.4.1/go.mod h1:TNfzLD0ON7rHzMJeJkieUDPYmFC7Snx/y86RQel1bk4=
 github.com/prometheus/common v0.6.0/go.mod h1:eBmuwkDJBwy6iBfxCBob6t6dR6ENT/y+J+Zk0j9GMYc=
-github.com/prometheus/common v0.51.1 h1:eIjN50Bwglz6a/c3hAgSMcofL3nD+nFQkV6Dd4DsQCw=
-github.com/prometheus/common v0.51.1/go.mod h1:lrWtQx+iDfn2mbH5GUzlH9TSHyfZpHkSiG1W7y3sF2Q=
+github.com/prometheus/common v0.47.0 h1:p5Cz0FNHo7SnWOmWmoRozVcjEp0bIVU8cV7OShpjL1k=
+github.com/prometheus/common v0.47.0/go.mod h1:0/KsvlIEfPQCQ5I2iNSAWKPZziNCvRs5EC6ILDTlAPc=
 github.com/prometheus/procfs v0.0.0-20181005140218-185b4288413d/go.mod h1:c3At6R/oaqEKCNdg8wHV1ftS6bRYblBhIjjI8uT2IGk=
 github.com/prometheus/procfs v0.0.2/go.mod h1:TjEm7ze935MbeOT/UhFTIMYKhuLP4wbCsTZCD3I8kEA=
 github.com/prometheus/procfs v0.0.3/go.mod h1:4A/X28fw3Fc593LaREMrKMqOKvUAntwMDaekg4FpcdQ=
@@ -969,16 +969,16 @@ k8s.io/kube-openapi v0.0.0-20231010175941-2dd684a91f00 h1:aVUu9fTY98ivBPKR9Y5w/A
 k8s.io/kube-openapi v0.0.0-20231010175941-2dd684a91f00/go.mod h1:AsvuZPBlUDVuCdzJ87iajxtXuR9oktsTctW/R9wwouA=
 k8s.io/kube-proxy v0.29.6 h1:H/wPg6vJ8ObzTJzV2bGQO/Nria5bXMlJxrPlxiacpJI=
 k8s.io/kube-proxy v0.29.6/go.mod h1:EUKqW0BvMyPWbnlKRKJerLgrFBFRhoNNuMvhefJxCPc=
-k8s.io/kube-state-metrics/v2 v2.12.0 h1:is2KqFjpkF+tLqhNfr1sWCEvucb//S50wxzzEhXRzHI=
-k8s.io/kube-state-metrics/v2 v2.12.0/go.mod h1:s1Iq7mNhtbb4fnwMw39uUOrpdIaeoyDQDWA7OZoOqhc=
+k8s.io/kube-state-metrics/v2 v2.11.0 h1:SSp45nHWty4/1RTx9InxTvmEbQ7GAg8l5AWgB84aNRo=
+k8s.io/kube-state-metrics/v2 v2.11.0/go.mod h1:huOgAz/5dqUoPsoqbE8/VPiLLm93jPedmWmzj3fwrWo=
 k8s.io/kubelet v0.29.6 h1:jXnnBNHK/KNNEJesmlIZmCvlYC3a5/e04BIS9VPM49M=
 k8s.io/kubelet v0.29.6/go.mod h1:kGEUqodVM120YTTQLSCTXzZP4XMFDp7qLf7iU3hrRE4=
 k8s.io/metrics v0.29.6 h1:kjMGPYxtCi4OO0fUar76y0CiUoeGYDNmUV0LXJIis4Q=
 k8s.io/metrics v0.29.6/go.mod h1:vqGzOaYGuNSSAI7GM1+v6L5z8aAUSzui1W0eQB3wVJY=
 k8s.io/pod-security-admission v0.29.6 h1:xxT9NWEWnbS49y6p7jY9S4pvcUBd9/8vPx2Y8GSZvrU=
 k8s.io/pod-security-admission v0.29.6/go.mod h1:KKimOte/+7k3NJbvRFdRDRTPvgUNSzUVABT9tDIAzLw=
-k8s.io/sample-controller v0.29.3 h1:1g96iu1sH9zFaZ4Nq7s10R1eq1cNgiM9l/F4ttEURJI=
-k8s.io/sample-controller v0.29.3/go.mod h1:zjhfoVX5Bcf7G4yNUoUmhXbVMMqM+TUoz3pILzH0OLo=
+k8s.io/sample-controller v0.28.4 h1:qghAHWGAFbDaTssOEiktdjbpq9avioOKRMB+KEwBIR0=
+k8s.io/sample-controller v0.28.4/go.mod h1:XXL627j2rVrUQTMpebt6imNnSE30tmFnAOvZsYUsWpo=
 k8s.io/utils v0.0.0-20200729134348-d5654de09c73/go.mod h1:jPW/WVKK9YHAvNhRxK0md/EJ228hCsBRufyofKtW8HA=
 k8s.io/utils v0.0.0-20240502163921-fe8a2dddb1d0 h1:jgGTlFYnhF1PM1Ax/lAlxUPE+KfCIXHaathvJg1C3ak=
 k8s.io/utils v0.0.0-20240502163921-fe8a2dddb1d0/go.mod h1:OLgZIPagt7ERELqWJFomSt595RzquPNLL48iOWgYOg0=
--
2.44.0
